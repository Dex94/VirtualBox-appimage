name: Release VirtualBox Appimage
concurrency:
  group: build-${{ github.ref }}
  cancel-in-progress: true

on:
  schedule:
    - cron: "0 14 * * 4"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: build
      run: |
        APP=virtualbox
        chmod +x create-arch-bootstrap.sh create-conty.sh "$APP"-conty-builder.sh
        sudo ./create-arch-bootstrap.sh && ./create-conty.sh
        mkdir -p tmp/"$APP".AppDir
        mv ./conty.sh tmp/"$APP".AppDir/ || exit 1
        ./"$APP"-conty-builder.sh
        mkdir dist
        mv *AppImage dist/
    - uses: dev-drprasad/delete-tag-and-release@v1.0
      with:
        tag_name: continuous
        github_token: ${{ secrets.GITHUB_TOKEN }}
        delete_release: true

    - uses: rickstaa/action-create-tag@v1
      id: "tag_create"
      with:
        tag: "continuous"

    - uses: softprops/action-gh-release@v1
      with:
        files: ./dist/*.AppImage
        prerelease: false
        draft: false
        tag_name: continuous
        name: Continuous
